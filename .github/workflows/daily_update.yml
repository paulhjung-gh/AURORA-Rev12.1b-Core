name: AURORA Daily Auto Update

permissions:
  contents: write

on:
  schedule:
    - cron: "30 9 * * *"  # 매일 오전 9:30에 실행
  workflow_dispatch:  # 수동 실행 가능

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip3 install yfinance pandas numpy scipy requests beautifulsoup4

    - name: Fetch Market Data (Including FRED API Data)
      env:
        FRED_API_KEY: ${{ secrets.FRED_API_KEY }}  # Secrets에서 환경 변수로 가져오기
      run: |
        python scripts/fetch_market_data.py  # FRED API 호출

    - name: Build Final Market Data JSON
      run: python scripts/build_market_json.py

    # Run the Aurora engine automatically
    - name: Run AURORA Engine
      run: python scripts/run_engine_auto.py

    - name: Commit and Push
      run: |
        git config user.name "aurora-bot"
        git config user.email "bot@example.com"
        git add .
        git commit -m "Daily automated update"
        git push
